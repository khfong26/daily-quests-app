<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Daily Quests - Test</title>
  <style>
    body {
      background: #1a1a2e;
      color: white;
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .button {
      background: #4CAF50;
      color: white;
      padding: 10px 20px;
      border: none;
      cursor: pointer;
      margin: 5px;
      border-radius: 5px;
    }
    .quest {
      background: #333;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
    }
    .stats {
      background: #444;
      padding: 15px;
      margin: 10px 0;
      border-radius: 5px;
    }
  </style>
</head>
<body>
  <div id="app"></div>

  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script type="text/babel">
    const { useState, useEffect } = React;

    function App() {
      const [quests, setQuests] = useState([]);
      const [xp, setXp] = useState(0);
      const [streak, setStreak] = useState(0);
      const [combo, setCombo] = useState(1);
      const [lastActiveDate, setLastActiveDate] = useState(null);
      const [isLoaded, setIsLoaded] = useState(false);

      // Load saved data
      useEffect(() => {
        try {
          const savedData = localStorage.getItem("dailyQuestsApp");
          if (savedData) {
            const saved = JSON.parse(savedData);
            console.log("Loading saved data:", saved);
            
            setQuests(saved.quests || []);
            setXp(saved.xp || 0);
            setStreak(saved.streak || 0);
            setCombo(saved.combo || 1);
            setLastActiveDate(saved.lastActiveDate || null);
          } else {
            console.log("No saved data found");
          }
        } catch (error) {
          console.error("Error loading saved data:", error);
        } finally {
          setIsLoaded(true);
        }
      }, []);

      // Save on change
      useEffect(() => {
        if (!isLoaded) return;
        
        try {
          const dataToSave = { quests, xp, streak, combo, lastActiveDate };
          localStorage.setItem("dailyQuestsApp", JSON.stringify(dataToSave));
          console.log("Data saved:", dataToSave);
        } catch (error) {
          console.error("Error saving data:", error);
        }
      }, [quests, xp, streak, combo, lastActiveDate, isLoaded]);

      const addTestQuest = () => {
        const newQuest = {
          name: `Test Quest ${quests.length + 1}`,
          type: Math.random() > 0.5 ? "main" : "side",
          attribute: "testing",
          frequency: Math.random() > 0.5 ? "daily" : "normal",
          done: false
        };
        setQuests([...quests, newQuest]);
      };

      const toggleQuest = (index) => {
        const updated = [...quests];
        updated[index].done = !updated[index].done;
        setQuests(updated);
        setXp(prev => prev + 10);
      };

      const clearData = () => {
        localStorage.removeItem("dailyQuestsApp");
        setQuests([]);
        setXp(0);
        setStreak(0);
        setCombo(1);
        setLastActiveDate(null);
      };

      const setNewDate = () => {
        const newDate = new Date();
        newDate.setDate(newDate.getDate() + 1);
        setLastActiveDate(newDate.toDateString());
      };

      return (
        <div>
          <h1>Daily Quests - Persistence Test</h1>
          
          <div className="stats">
            <p>XP: {xp}</p>
            <p>Streak: {streak}</p>
            <p>Combo: {combo}</p>
            <p>Last Active: {lastActiveDate || 'Never'}</p>
            <p>Quests Count: {quests.length}</p>
          </div>

          <button className="button" onClick={addTestQuest}>Add Test Quest</button>
          <button className="button" onClick={setNewDate}>Set Tomorrow's Date</button>
          <button className="button" onClick={clearData}>Clear All Data</button>
          <button className="button" onClick={() => window.location.reload()}>Refresh Page</button>

          <div>
            <h3>Quests:</h3>
            {quests.map((quest, index) => (
              <div key={index} className="quest">
                <p><strong>{quest.name}</strong></p>
                <p>Type: {quest.type}, Frequency: {quest.frequency}, Attribute: {quest.attribute}</p>
                <p>Done: {quest.done ? 'Yes' : 'No'}</p>
                <button className="button" onClick={() => toggleQuest(index)}>
                  {quest.done ? 'Undo' : 'Complete'}
                </button>
              </div>
            ))}
          </div>

          <div style={{marginTop: '20px', fontSize: '12px', color: '#888'}}>
            <p>Open browser console to see persistence logs</p>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("app")).render(<App />);
  </script>
</body>
</html>